<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - Goalie</title>
</head>
<body>
<header layout:fragment="header">
    <section class="main_section">
        <nav>
            <div class="navlogo">
                <div data-aos="fade-right">
                    <img th:src="@{/images/logo.jpg}" alt="Goalie Logo">
                </div>
                <a th:href="@{/home}" data-aos="fade-down">Goalie</a>
            </div>
            <div class="nav_list" data-aos="zoom-in">
                <a th:href="@{/tournaments}">Tournaments</a>
                <a th:href="@{/notifications}">Notifications</a>
                <a th:href="@{/faq}">FAQ</a>
                <a href="#footer">Contact Us</a>
                <a class="profile-pic" th:href="@{/profile_account}">
                    <div>
                        <img th:src="@{/images/profile.jpg}">
                    </div>
                    <h4 th:text="${user.name}"></h4>
                </a>
            </div>
        </nav>
    </section>
</header>
<main layout:fragment="content">
    <section class="home-modern">
        <!-- Hero Section with Mode Switcher -->
        <div class="hero-section">
            <div class="hero-content">
                <h1 class="welcome-title">
                    Welcome back, <span th:text="${user.name}"></span>! üëã
                </h1>
                <p class="welcome-subtitle">Choose your plan to get started</p>

                <!-- Plan Switcher -->
                <div class="mode-switcher">
                    <form method="post" th:action="@{/switch-plan}" class="mode-form">
                        <div class="mode-toggle">
                            <button type="submit" name="plan" value="basic"
                                    th:class="${currentPlan == 'basic' ? 'mode-btn active' : 'mode-btn'}"
                                    th:disabled="${currentPlan == 'basic'}">
                                <span class="mode-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="4" y1="6" x2="20" y2="6"></line>
                                        <line x1="4" y1="12" x2="20" y2="12"></line>
                                        <line x1="4" y1="18" x2="20" y2="18"></line>
                                    </svg>
                                </span>
                                <span class="mode-label">Basic Plan</span>
                                <span class="mode-desc">Free Access</span>
                            </button>
                            <button type="submit" name="plan" value="premium"
                                    th:class="${isPremium ? 'mode-btn active premium-active' : 'mode-btn premium-btn'}"
                                    th:disabled="${isPremium}">
                                <span class="mode-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="4" y1="5" x2="20" y2="5"></line>
                                        <line x1="4" y1="9" x2="20" y2="9"></line>
                                        <line x1="4" y1="13" x2="20" y2="13"></line>
                                        <line x1="4" y1="17" x2="20" y2="17"></line>
                                        <line x1="4" y1="21" x2="20" y2="21"></line>
                                    </svg>
                                </span>
                                <span class="mode-label">Premium Plan</span>
                                <span class="mode-desc" th:text="${isPremium ? 'Active' : '$9.99/month'}">$9.99/month</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Payment Success/Error Messages -->
        <div th:if="${paymentSuccess}" class="payment-message success-message">
            <p th:text="${paymentSuccess}"></p>
        </div>
        <div th:if="${paymentError}" class="payment-message error-message">
            <p th:text="${paymentError}"></p>
        </div>

        <!-- Stats Dashboard -->
        <div class="stats-dashboard">
            <div class="stat-card">
                <div class="stat-icon">üèÜ</div>
                <div class="stat-content">
                    <h3 th:text="${tournamentCount}">0</h3>
                    <p>Tournaments</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚öΩ</div>
                <div class="stat-content">
                    <h3>0</h3>
                    <p>Matches</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üë•</div>
                <div class="stat-content">
                    <h3>0</h3>
                    <p>Teams</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-content">
                    <h3>0</h3>
                    <p>Ranking</p>
                </div>
            </div>
        </div>

        <!-- Action Cards - Same for All Plans -->
        <div class="action-section">
            <h2 class="section-title">Dashboard</h2>
            <div class="action-grid">
                <a th:href="@{/tournaments}" class="action-card join-tournament">
                    <div class="card-icon">üéØ</div>
                    <h3>Join Tournament</h3>
                    <p>Browse and join available tournaments</p>
                    <span class="card-arrow">‚Üí</span>
                </a>
                <a th:href="@{/tournaments/create}" class="action-card create-tournament">
                    <div class="card-icon">‚ûï</div>
                    <h3>Create Tournament</h3>
                    <p>Organize and schedule your own tournament</p>
                    <span class="card-arrow">‚Üí</span>
                </a>
                <a th:href="@{/tournaments}" class="action-card create-team">
                    <div class="card-icon">üë•</div>
                    <h3>Create Team</h3>
                    <p>Select a tournament and create your team</p>
                    <span class="card-arrow">‚Üí</span>
                </a>
                <a href="#" class="action-card my-teams">
                    <div class="card-icon">üèÉ</div>
                    <h3>My Teams</h3>
                    <p>View and manage your teams</p>
                    <span class="card-arrow">‚Üí</span>
                </a>
                <a href="#" class="action-card leaderboard">
                    <div class="card-icon">üèÖ</div>
                    <h3>Leaderboard</h3>
                    <p>Check rankings and your position</p>
                    <span class="card-arrow">‚Üí</span>
                </a>
                <a href="#" class="action-card analytics">
                    <div class="card-icon">üìä</div>
                    <h3>Analytics</h3>
                    <p>View statistics and insights</p>
                    <span class="card-arrow">‚Üí</span>
                </a>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h2 class="section-title">Quick Actions</h2>
            <div class="quick-action-buttons">
                <a th:href="@{/profile_account}" class="quick-btn">
                    <span>‚öôÔ∏è</span> Profile Settings
                </a>
                <a th:href="@{/tournaments}" class="quick-btn">
                    <span>üîç</span> Browse Tournaments
                </a>
                <a href="#" class="quick-btn">
                    <span>üí¨</span> Messages
                </a>
                <a th:href="@{/notifications}" class="quick-btn">
                    <span>üîî</span> Notifications
                </a>
            </div>
        </div>
    </section>
</main>

<!-- Player Setup Modal -->
<div th:if="${showPlayerSetup}" id="playerSetupModal" class="modal-overlay">
    <div class="modal-container">
        <div class="modal-header">
            <h2>Welcome to Player Mode! üéÆ</h2>
            <p>Let's set up your player profile to get started</p>
        </div>
        <form id="playerProfileForm" method="post" th:action="@{/setup-player-profile}" class="modal-form">
            <div class="form-group">
                <label for="playerNickname">Player Nickname *</label>
                <input type="text" id="playerNickname" name="playerNickname"
                       placeholder="Enter your player nickname" required>
            </div>

            <div class="form-group">
                <label>Skill Level *</label>
                <div class="star-rating">
                    <input type="radio" id="star5" name="skillRating" value="5" required>
                    <label for="star5" class="star">‚òÖ</label>
                    <input type="radio" id="star4" name="skillRating" value="4">
                    <label for="star4" class="star">‚òÖ</label>
                    <input type="radio" id="star3" name="skillRating" value="3">
                    <label for="star3" class="star">‚òÖ</label>
                    <input type="radio" id="star2" name="skillRating" value="2">
                    <label for="star2" class="star">‚òÖ</label>
                    <input type="radio" id="star1" name="skillRating" value="1">
                    <label for="star1" class="star">‚òÖ</label>
                </div>
                <span class="rating-text">Select your skill level</span>
            </div>

            <div class="form-group">
                <label for="preferredPosition">Preferred Position</label>
                <select id="preferredPosition" name="preferredPosition" class="form-select">
                    <option value="">Select position</option>
                    <option value="GOALKEEPER">Goalkeeper</option>
                    <option value="DEFENDER">Defender</option>
                    <option value="MIDFIELDER">Midfielder</option>
                    <option value="FORWARD">Forward</option>
                </select>
            </div>

            <div class="form-group">
                <label for="dominantFoot">Dominant Foot</label>
                <select id="dominantFoot" name="dominantFoot" class="form-select">
                    <option value="">Select foot</option>
                    <option value="LEFT">Left</option>
                    <option value="RIGHT">Right</option>
                    <option value="BOTH">Both</option>
                </select>
            </div>

            <div class="form-group">
                <label for="bio">Bio (Optional)</label>
                <textarea id="bio" name="bio" rows="3"
                          placeholder="Tell us about yourself as a player..."></textarea>
            </div>

            <div class="modal-actions">
                <button type="submit" class="btn-primary">Complete Setup</button>
            </div>
        </form>
    </div>
</div>

<!-- Premium Payment Modal -->
<div th:if="${showPaymentForm}" id="paymentModal" class="modal-overlay">
    <div class="modal-container">
        <div class="modal-header">
            <h2>Upgrade to Premium ‚≠ê</h2>
            <p>Unlock all premium features for just $9.99/month</p>
        </div>
        <form id="paymentForm" method="post" th:action="@{/upgrade-premium}" class="modal-form">
            <div class="payment-info">
                <div class="price-display">
                    <span class="price">$9.99</span>
                    <span class="price-period">/month</span>
                </div>
                <div class="premium-features">
                    <h3>Premium Features:</h3>
                    <ul>
                        <li>‚úÖ Unlimited tournaments</li>
                        <li>‚úÖ Advanced analytics</li>
                        <li>‚úÖ Priority support</li>
                        <li>‚úÖ Custom branding</li>
                        <li>‚úÖ Player profile setup</li>
                    </ul>
                </div>
            </div>

            <div class="form-group">
                <label for="cardNumber">Card Number *</label>
                <input type="text" id="cardNumber" name="cardNumber"
                       placeholder="1234 5678 9012 3456"
                       maxlength="19" required
                       pattern="[0-9\s]{13,19}">
            </div>

            <div class="form-group">
                <label for="cardHolder">Cardholder Name *</label>
                <input type="text" id="cardHolder" name="cardHolder"
                       placeholder="John Doe" required>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="expiryDate">Expiry Date *</label>
                    <input type="text" id="expiryDate" name="expiryDate"
                           placeholder="MM/YY"
                           maxlength="5" required
                           pattern="(0[1-9]|1[0-2])\/[0-9]{2}">
                </div>

                <div class="form-group">
                    <label for="cvv">CVV *</label>
                    <input type="text" id="cvv" name="cvv"
                           placeholder="123"
                           maxlength="4" required
                           pattern="[0-9]{3,4}">
                </div>
            </div>

            <div th:if="${paymentError}" class="error-message global-error">
                <p th:text="${paymentError}"></p>
            </div>

            <div class="modal-actions">
                <button type="submit" class="btn-primary">
                    <span>Pay $9.99/month</span>
                </button>
                <a href="/home" class="btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>

<script>
    // Star Rating Interaction
    document.addEventListener('DOMContentLoaded', function() {
        const stars = document.querySelectorAll('.star-rating input[type="radio"]');
        const ratingText = document.querySelector('.rating-text');
        const ratingLabels = {
            1: 'Beginner',
            2: 'Novice',
            3: 'Intermediate',
            4: 'Advanced',
            5: 'Expert'
        };

        stars.forEach(star => {
            star.addEventListener('change', function() {
                const value = parseInt(this.value);
                const ratingText = document.querySelector('.rating-text');
                if (ratingText) {
                    ratingText.textContent = ratingLabels[value] || 'Select your skill level';
                    ratingText.style.color = 'var(--accent)';
                }
            });
        });

        // Player setup modal appears automatically when:
        // 1. User switches to Premium Plan (clicks Premium button)
        // 2. User doesn't have a player profile yet (first time)
        // 3. Thymeleaf renders it with th:if="${showPlayerSetup}"
        const playerModal = document.getElementById('playerSetupModal');
        if (playerModal) {
            console.log('Player setup modal detected');
        }

        // Payment modal appears when:
        // 1. User clicks Premium button
        // 2. User doesn't have premium subscription
        const paymentModal = document.getElementById('paymentModal');
        if (paymentModal) {
            console.log('Payment modal detected');
        }

        // Format card number input
        const cardNumberInput = document.getElementById('cardNumber');
        if (cardNumberInput) {
            cardNumberInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\s/g, '');
                let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
                if (formattedValue.length <= 19) {
                    e.target.value = formattedValue;
                }
            });
        }

        // Format expiry date input
        const expiryInput = document.getElementById('expiryDate');
        if (expiryInput) {
            expiryInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length >= 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2, 4);
                }
                e.target.value = value;
            });
        }

        // Format CVV input (numbers only)
        const cvvInput = document.getElementById('cvv');
        if (cvvInput) {
            cvvInput.addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/\D/g, '');
            });
        }
    });
</script>
</body>
</html>